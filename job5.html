<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>XX电商·运营后台·订单录入与销售看板</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .box { border: 1px solid #ddd; padding: 10px; margin: 10px 0; }
        .clock { font-size: 20px; font-weight: bold; color: #336699; margin: 10px 0; }
        label { display: inline-block; width: 120px; margin: 5px 0; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 4px 8px; text-align: center; }
        .form-group { margin: 10px 0; }
        button { padding: 6px 12px; background: #3aa0e6; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #288bd4; }
        .tip-box { padding: 12px; background: #eef9ff; border-left: 5px solid #3aa0e6; margin: 10px 0; line-height: 1.6; }
        .result-box { margin: 15px 0; padding: 10px; border: 1px solid #eee; }
    </style>
</head>
<body>
    <!-- 第一部分：折扣与加价提示（document.write实现） -->
    <script>
        document.write("<h1>XX电商·运营后台·订单录入与销售看板</h1>");
        document.write("<p>欢迎使用内部工具，实时查看订单与销售情况。</p>");
        document.write(`
            <div class="tip-box">
                <strong>温馨提示：本店当前可享受的优惠与加价政策如下：</strong>
                <ul style="margin: 8px 0 0 20px; line-height: 1.6;">
                    <li>VIP 客户享受<strong>9 折优惠</strong></li>
                    <li>加急发货价格会 <strong>×1.1</strong></li>
                    <li>每小时前10分钟再享 <strong>8.5 折</strong></li>
                    <li>VIP客户未享受时间折扣时，额外享受<strong>9.5折补偿</strong>（学号末位7专属规则）</li>
                </ul>
            </div>
        `);
    </script>

    <!-- 第二部分：模拟时钟 -->
    <div class="clock" id="clock"></div>
    <div id="timeDiscountTip" class="tip-box" style="background: #fff3cd; border-left-color: #ffc107; display: none;"></div>

    <!-- 订单录入表单 -->
    <div class="box">
        <h3>新建订单</h3>
        <form onsubmit="return validateForm()">
            <div class="form-group">
                <label>客户名称：</label>
                <input type="text" id="customerName" placeholder="请输入客户名称">
            </div>
            <div class="form-group">
                <label>商品单价（¥）：</label>
                <input type="text" id="priceInput" placeholder="请输入大于0的数字">
            </div>
            <div class="form-group">
                <label>数量（件）：</label>
                <input type="text" id="qtyInput" placeholder="请输入大于0的整数">
            </div>
            <div class="form-group">
                <label>客户类型：</label>
                <select id="customerType">
                    <option value="normal">普通客户</option>
                    <option value="vip">VIP客户</option>
                </select>
            </div>
            <div class="form-group">
                <label>加急发货：</label>
                <input type="checkbox" id="urgentFlag"> 是
            </div>
            <div class="form-group">
                <button type="submit">添加订单</button>
            </div>
        </form>
    </div>

    <!-- 订单结果显示区域 -->
    <div class="result-box" id="orderResult"></div>

    <!-- 成交历史看板 -->
    <div class="box">
        <h3>成交历史记录</h3>
        <table>
            <thead>
                <tr>
                    <<th>客户名称</</th>
                    <<th>商品单价</</th>
                    <<th>购买数量</</th>
                    <<th>基础金额</</th>
                    <<th>客户类型</</th>
                    <<th>是否加急</</th>
                    <<th>是否享受时段折扣</</th>
                    <<th>最终金额</</th>
                </tr>
            </thead>
            <tbody id="orderTableBody">
                <!-- 历史订单将通过JavaScript动态渲染 -->
            </tbody>
        </table>
    </div>

    <script>
        // 存储所有订单数据
        let orders = [];

        // 第二部分：时钟功能与时段折扣提示
        function padZero(n) {
            return n < 10 ? "0" + n : n;
        }

        function updateClock() {
            var now = new Date();
            var y = now.getFullYear();
            var m = now.getMonth() + 1;
            var d = now.getDate();
            var hh = now.getHours();
            var mm = now.getMinutes();
            var ss = now.getSeconds();
            var weekNames = ["日", "一", "二", "三", "四", "五", "六"];
            var w = weekNames[now.getDay()];
            var timeStr = y + "年" + padZero(m) + "月" + padZero(d) + "日 星期" + w + " " + padZero(hh) + ":" + padZero(mm) + ":" + padZero(ss);
            
            // 更新时钟显示
            document.getElementById("clock").innerHTML = timeStr;

            // 时段折扣提示（每小时前10分钟）
            var timeTipElement = document.getElementById("timeDiscountTip");
            if (mm >= 0 && mm <= 9) {
                timeTipElement.innerHTML = "<strong>当前时段优惠：</strong>每小时前10分钟，享受8.5折优惠！";
                timeTipElement.style.display = "block";
            } else {
                timeTipElement.innerHTML = "<strong>当前时段提示：</strong>非前10分钟时段，无时段折扣";
                timeTipElement.style.display = "block";
            }
        }

        // 页面加载时初始化时钟
        updateClock();
        setInterval(updateClock, 1000);

        // 第三部分：表单验证
        function validateForm() {
            var nameStr = document.getElementById("customerName").value;
            var priceStr = document.getElementById("priceInput").value;
            var qtyStr = document.getElementById("qtyInput").value;
            var typeStr = document.getElementById("customerType").value;
            var urgentChecked = document.getElementById("urgentFlag").checked;
            var valid = true;

            // 客户名称校验
            if (nameStr == null || nameStr.trim() === "") {
                alert("客户名称不能为空！");
                valid = false;
            }

            // 商品单价校验（大于0的数字）
            var price = parseFloat(priceStr);
            if (isNaN(price) || price <= 0) {
                alert("商品单价必须是大于0的数字！");
                valid = false;
            }

            // 数量校验（大于0的整数）
            var qty = parseInt(qtyStr, 10);
            if (isNaN(qty) || qty <= 0) {
                alert("数量必须是大于0的整数！");
                valid = false;
            }

            if (!valid) {
                document.getElementById("orderResult").innerHTML = "<p style='color: red;'>订单录入失败，请检查输入。</p>";
                return false;
            }

            // 验证通过，处理订单
            processOrder(nameStr.trim(), price, qty, typeStr === "vip", urgentChecked);
            return false;
        }

        // 第四部分：订单处理（含学号末位7的折扣逻辑）
        function processOrder(customerName, price, quantity, isVip, isUrgent) {
            // 基础金额：单价 × 数量
            var baseTotal = price * quantity;
            // VIP折扣：9折
            var afterVip = isVip ? baseTotal * 0.9 : baseTotal;
            // 加急加价：×1.1
            var afterUrgent = isUrgent ? afterVip * 1.1 : afterVip;
            // 时段折扣：前10分钟8.5折
            var now = new Date();
            var minute = now.getMinutes();
            var hitTimeDiscount = minute >= 0 && minute <= 9;
            var finalTotal = afterUrgent;

            // 时段折扣应用
            if (hitTimeDiscount) {
                finalTotal *= 0.85;
            }

            // 学号末位7专属规则：VIP客户未享受时间折扣时，额外9.5折补偿
            var hasVipCompensation = false;
            if (isVip && !hitTimeDiscount) {
                finalTotal *= 0.95;
                hasVipCompensation = true;
            }

            // 订单类型判断（大额VIP订单）
            var isImportant = isVip && finalTotal > 1000;

            // 构建优惠详情HTML
            var tipsHtml = "<ul>";
            tipsHtml += isVip ? "<li>VIP 9折已应用</li>" : "<li>普通客户无VIP优惠</li>";
            tipsHtml += isUrgent ? "<li>加急 ×1.1 已应用</li>" : "<li>未加急</li>";
            tipsHtml += hitTimeDiscount ? "<li>命中前10分钟 ×0.85</li>" : "<li>无时段折扣</li>";
            tipsHtml += hasVipCompensation ? "<li>VIP未享时段折扣，补偿9.5折</li>" : "";
            tipsHtml += "</ul>";

            // 显示订单结果
            document.getElementById("orderResult").innerHTML = `
                <h3>订单录入成功：</h3>
                <p>客户名称：${customerName}</p>
                <p>基础金额：¥${baseTotal.toFixed(2)}</p>
                <p>VIP后：¥${afterVip.toFixed(2)}</p>
                <p>加急后：¥${afterUrgent.toFixed(2)}</p>
                ${hasVipCompensation ? `<p>VIP补偿后：¥${finalTotal.toFixed(2)}</p>` : ""}
                <p>最终金额：¥${finalTotal.toFixed(2)}</p>
                <p>订单类型：${isImportant ? "大额VIP订单" : "普通订单"}</p>
                <div style='background:#eef; padding:8px; '>优惠详情：${tipsHtml}</div>
            `;

            // 存储订单数据
            orders.push({
                name: customerName,
                price: price,
                qty: quantity,
                baseTotal: baseTotal,
                finalTotal: finalTotal,
                isVip: isVip,
                isUrgent: isUrgent,
                hitTimeDiscount: hitTimeDiscount,
                hasVipCompensation: hasVipCompensation
            });

            // 渲染成交历史
            renderDashboard();
        }

        // 第五部分：渲染成交历史看板
        function renderDashboard() {
            var tableBody = document.getElementById("orderTableBody");
            // 清空表格内容
            tableBody.innerHTML = "";

            // 遍历订单数据，生成表格行
            orders.forEach(order => {
                var tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${order.name}</td>
                    <td>¥${order.price.toFixed(2)}</td>
                    <td>${order.qty}</td>
                    <td>¥${order.baseTotal.toFixed(2)}</td>
                    <td>${order.isVip ? "VIP客户" : "普通客户"}</td>
                    <td>${order.isUrgent ? "是" : "否"}</td>
                    <td>${order.hitTimeDiscount ? "是" : "否"}</td>
                    <td>¥${order.finalTotal.toFixed(2)}</td>
                `;
                tableBody.appendChild(tr);
            });
        }
    </script>
</body>
</html>